<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Why - Melange</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/print-site-enum-headings1.css" rel="stylesheet" />
        <link href="../css/print-site-enum-headings2.css" rel="stylesheet" />
        <link href="../css/print-site-enum-headings3.css" rel="stylesheet" />
        <link href="../css/print-site-enum-headings4.css" rel="stylesheet" />
        <link href="../css/print-site-enum-headings5.css" rel="stylesheet" />
        <link href="../css/print-site-enum-headings6.css" rel="stylesheet" />
        <link href="../css/print-site.css" rel="stylesheet" />
        <link href="../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Why";
        var mkdocs_page_input_path = "rationale.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/languages/ocaml.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Melange
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="./">Why</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#a-bit-of-history">A bit of history</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#js_of_ocaml">Js_of_ocaml</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#bucklescript">BuckleScript</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#reason">Reason</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#bucklescript-gets-rebranded">BuckleScript gets rebranded</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#melange-back-to-ocaml">Melange: back to OCaml</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../getting-started/">Getting Started</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Learn</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../new-to-ocaml/">New to OCaml?</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../package-management/">Package management</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build-system/">Build system</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../communicate-with-javascript/">Communicate with JavaScript</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../api/">API</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Try</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../try/">Playground</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Talk</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../community/">Community</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Melange</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
      <li>Why</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/melange-re/documentation-site/blob/master/docs/rationale.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="why-melange">Why Melange</h1>
<p>OCaml offers an industrial-strength, state-of-the-art type system and provides
type inference with very few type annotations, proving invaluable in managing
large projects.</p>
<p>JavaScript is one of the most pervasive platforms to deploy and run software.
Thanks to years of efforts to improve the different VMs available, the
JavaScript code running on browsers and other environments is heavily optimized
and can support use cases for large products and tools.</p>
<p>Melange helps developers and companies bring the advantages of the OCaml
platform to users of the Web platform in a way that makes it easy for developers
to integrate with both ecosystems.</p>
<h2 id="a-bit-of-history">A bit of history</h2>
<p>To better understand where Melange comes from, it might help to go through some
of the related projects that have appeared over the last decade or so.</p>
<h3 id="js_of_ocaml">Js_of_ocaml</h3>
<p><a href="https://github.com/ocsigen/js_of_ocaml/">Js_of_ocaml</a> is another OCaml to
JavaScript compiler that was made public in 2011. In <a href="https://www.irif.fr/~balat/publications/vouillon_balat-js_of_ocaml.pdf">the presentation
paper</a>
published in 2013, it’s explicitly mentioned that one of its design goals was to
remain as compatible as possible with the OCaml compiler, without requiring a
lot of maintenance work, as the OCaml community was not excessively large at the
time.</p>
<p>To achieve this goal, Js_of_ocaml picks the bytecode generated by OCaml <a href="https://ocaml.org/manual/comp.html">batch
compilation</a> and generates JavaScript from
it. OCaml bytecode has a very stable interface, so Js_of_ocaml can easily
upgrade to new versions of the compiler. Due to this design decision, it can
also remain compatible with most of the OCaml ecosystem, as long as the tools or
libraries don’t rely on C code.</p>
<p>The downside of using bytecode is that it gets harder to communicate with
existing JavaScript code. This is due to both the constraints on runtime
representations that Js_of_ocaml can use for OCaml values, and also the
compilation model used, where one bytecode program is compiled to one JavaScript
program, but it is not possible to generate an individual JavaScript module from
one OCaml module.</p>
<p>Another downside is that the resulting JavaScript is hard to read, as it is
converted from a low-level representation like bytecode.</p>
<h3 id="bucklescript">BuckleScript</h3>
<p>Then, in 2016, Bob Zhang suggests <a href="https://github.com/ocsigen/js_of_ocaml/issues/338">on a Js_of_ocaml repository
issue</a> the possibility to
start converting to JavaScript from an earlier stage of the compilation process,
instead of using bytecode. This proposal fundamentally diverges from Js_of_ocaml
original design and goals, so he starts working on what will become
BuckleScript.</p>
<p>BuckleScript gets some inspiration from Js_of_ocaml, for example in the way that
JavaScript objects are represented with <code>Js.t</code>. But it differs from Js_of_ocaml
in many ways: it can generate more readable and lighter code. It also generates
one <code>.js</code> file per module, which makes it easier to integrate with existing
JavaScript codebases. BuckleScript puts a big emphasis on communicating with
JavaScript code through a rich collection of attributes applied to <code>external</code>
primitives.</p>
<h3 id="reason">Reason</h3>
<p>Around the same year, a project called <a href="https://reasonml.github.io/">Reason</a>
appears at Facebook. Led by Jordan Walke, the idea is to create an alternate
syntax for OCaml that is closer to C and JavaScript. Even if Reason has no take
on which platform the code is deployed —native applications binaries, or web
applications using JavaScript as a target language—, BuckleScript adds first
class support for Reason from early on. At that point, it becomes evident that
the combination of Reason with BuckleScript is a great match: BuckleScript
provides tools and infrastructure to work with JavaScript ecosystem, while
Reason allows developers to write their programs in a syntax they are familiar
with.</p>
<p>Over time, and with help of other Facebook employees and the community providing
bindings to pervasive JavaScript libraries like React.js with
<a href="https://github.com/reasonml/reason-react/"><code>reason-react</code></a>, the combination of
Reason and BuckleScript gains adoption.</p>
<h3 id="bucklescript-gets-rebranded">BuckleScript gets rebranded</h3>
<p>However, at some point the goals of both BuckleScript and Reason projects become
harder to reconcile. In August 2020, the BuckleScript team decides to rename to
ReScript, stops adding support for the latest versions of the Reason parser, and
replaces it with a new parser that changes the syntax. The reasons for the
rebranding are explained in <a href="https://rescript-lang.org/blog/bucklescript-is-rebranding">the official ReScript blog
post</a>.</p>
<p>The rebranding is trying to ease onboarding and adoption of the ReScript
language, giving the project more chances to compete with mainstream
compiled-to-JavaScript languages like TypeScript. However, for many existing
users of BuckleScript and Reason, it is the explicit confirmation of something
that had been hinted implicitly before: ReScript goals are not compatible with
providing a good integration with the OCaml ecosystem.</p>
<h3 id="melange-back-to-ocaml">Melange: back to OCaml</h3>
<p>This is where Melange comes in. A few weeks after the rebranding of BuckleScript
to ReScript, António Monteiro starts working on a fork of BuckleScript with a
simple (not easy) goal: replace the <a href="https://ninja-build.org/">Ninja build
system</a>, which BuckleScript had been using from its
creation, with <a href="https://dune.build/">Dune</a>, which is the most used build system
for OCaml projects.</p>
<p>This fork of BuckleScript is later named Melange. After finishing the switch
from Ninja to Dune, several additional features are added to bring it closer to
OCaml. Some examples are the upgrade of the OCaml compiler version used by
Melange, or modeling the changes to the OCaml compiler that Melange uses as
just a plain library, instead of a full fork of the upstream compiler.</p>
<p>In September 2022, Ahrefs decides to invest on Melange by funding a project to
deepen the integration between Dune and Melange. This project achieves its
completion in Spring 2023, with the <a href="https://tech.ahrefs.com/ahrefs-is-now-built-with-melange-b14f5ec56df4">migration of Ahrefs frontend codebase to
Melange</a>
and the new public releases that support it: version 3.8 of Dune and 1.0 of
Melange.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href=".." class="btn btn-neutral float-left" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../getting-started/" class="btn btn-neutral float-right" title="Getting Started">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/melange-re/documentation-site/" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../getting-started/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../js/print-site.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
